{
  "version": 3,
  "file": "cleanup.js",
  "sourceRoot": "",
  "sources": [
    "../src/cleanup.ts"
  ],
  "names": [],
  "mappings": ";;;AAEA,qBAAwB,AAAI,AAC5B,AAAC;AAAD,6BAAwD,AAAY,AACpE,AAAC;AAAD,2BAA2C,AAAU,AACrD,AAAC;AAAD,MAAY,AAAI,eAAM,AAAM,AAG5B,AAAC;AADD,AAAmC;AACnC,MAAM,AAAS,YAAG,AAAO,QAAC,AAAgB,AAAC;AAE3C;;AACE,cAAM,AAAG,MAAG,AAAI,KAAC,AAAI,KAAC,KAAO,AAAE,WAAE,AAAQ,UAAE,AAAK,AAAC;AACjD,YAAI,AAAK,QAAoB,AAAI;AACjC,YAAI,AAAC;AACH,AAAK,oBAAG,MAAM,aAAO,QAAC,AAAG,AAAC,AAC5B;AACA,UAAA,AAAK,AAAC,OAAC,AAAC,AAAC,GAAC,AAAC;AACT,AAAE,AAAC,gBAAC,AAAC,EAAC,AAAI,SAAK,AAAQ,AAAC,UAAC,AAAC;AACxB,sBAAM,AAAC,AACT;AAAC;AACD,AAAM,AACR;AAAC;AAED,yBAAqB,QAAC,AAAG,IAAC,AAAK,AAA2C,OAAQ,AAAE,EAAT;AACzE,gBAAI,AAAI,OAAiB,AAAI;AAC7B,kBAAM,AAAQ,WAAG,AAAI,KAAC,AAAI,KAAC,AAAG,KAAE,AAAE,AAAC;AACnC,gBAAI,AAAC;AACH,AAAI,uBAAG,MAAM,aAAK,MAAC,AAAQ,AAAC,AAC9B;AACA,cAAA,AAAK,AAAC,OAAC,AAAC,AAAC,GAAC,AAAC;AACT,AAAE,AAAC,oBAAC,AAAC,EAAC,AAAI,SAAK,AAAQ,AAAC,UAAC,AAAC;AACxB,0BAAM,AAAC,AACT;AAAC;AACD,AAAM,AACR;AAAC;AAED,AAAE,AAAC,gBAAC,CAAC,AAAK,KAAC,AAAW,AAAE,iBAAI,AAAC,EAAC,MAAM,AAAc,eAAC,AAAQ,AAAC,AAAC,AAAC,YAAC,AAAC;AAC9D,AAAO,wBAAC,AAAG,AAAC,sBAAiB,AAAQ,QAAE,AAAC;AACxC,sBAAM,aAAM,OAAC,AAAQ,AAAC,AACxB;AAAC,AACH;AAAC,AAAC,AAAC,UAjBG;AAmBN,cAAM,WAAe,QAAC,AAAG,IAAC,AAAK,OAAE,aAAM,AAAC,AAC1C;AAAC;AAAA;AAED,wBAA8B,AAAW;;AACvC,YAAI,AAAC;AACH,kBAAM,AAAQ,WAAG,AAAQ,UAAC,MAAM,aAAQ,SAAC,AAAI,KAAC,AAAI,KAAC,AAAG,KAAE,AAAW,AAAC,cAAE,AAAM,AAAC,UAAE,AAAE,AAAC;AAClF,AAAE,AAAC,gBAAC,CAAC,AAAK,MAAC,AAAQ,AAAC,aAAK,AAAI,KAAC,AAAG,AAAE,QAAG,AAAQ,AAAC,AAAG,QAA1B,GAA2B,AAAO,UAAG,AAAC,AAAC,AAAC,GAAC,AAAC;AAChE,AAAM,uBAAC,AAAI,AACb;AAAC,AACH;AACA,UAAA,AAAK,AAAC,OAAC,AAAC,AAAC,GAAC,AAAC;AACT,AAAE,AAAC,gBAAC,AAAC,EAAC,AAAI,SAAK,AAAQ,AAAC,UAAC,AAAC;AACxB,sBAAM,AAAC,AACT;AAAC,AACH;AAAC;AAED,AAAM,eAAC,AAAK,AACd;AAAC;AAAA;AAED,AAAI,AAAE",
  "sourcesContent": [
    "#! /usr/bin/env node\n\nimport { homedir } from \"os\"\nimport { readdir, lstat, Stats, remove, readFile } from \"fs-extra-p\"\nimport { Promise as BluebirdPromise } from \"bluebird\"\nimport * as path from \"path\"\n\n//noinspection JSUnusedLocalSymbols\nconst __awaiter = require(\"./util/awaiter\")\n\nasync function main() {\n  const dir = path.join(homedir(), \".cache\", \"fpm\")\n  let items: string[] | null = null\n  try {\n    items = await readdir(dir)\n  }\n  catch (e) {\n    if (e.code !== \"ENOENT\") {\n      throw e\n    }\n    return\n  }\n\n  await BluebirdPromise.map(items, <(item: string) => BluebirdPromise<any>> (async (it) => {\n    let stat: Stats | null = null\n    const itemPath = path.join(dir, it)\n    try {\n      stat = await lstat(itemPath)\n    }\n    catch (e) {\n      if (e.code !== \"ENOENT\") {\n        throw e\n      }\n      return\n    }\n\n    if (!stat!.isDirectory() || !(await isRecentlyUsed(itemPath))) {\n      console.log(`remove unused ${itemPath}`)\n      await remove(itemPath)\n    }\n  }))\n\n  await BluebirdPromise.map(items, remove)\n}\n\nasync function isRecentlyUsed(dir: string) {\n  try {\n    const lastUsed = parseInt(await readFile(path.join(dir, \".lastUsed\"), \"utf8\"), 10)\n    if (!isNaN(lastUsed) && (Date.now() - lastUsed) < (3600000 * 2)) {\n      return true\n    }\n  }\n  catch (e) {\n    if (e.code !== \"ENOENT\") {\n      throw e\n    }\n  }\n\n  return false\n}\n\nmain()"
  ]
}
