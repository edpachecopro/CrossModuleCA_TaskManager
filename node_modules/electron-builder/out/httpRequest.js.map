{
  "version": 3,
  "file": "httpRequest.js",
  "sourceRoot": "",
  "sources": [
    "../src/httpRequest.ts"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "import { Socket } from \"net\"\nimport { IncomingMessage, ClientRequest } from \"http\"\nimport * as https from \"https\"\nimport { createWriteStream, ensureDir } from \"fs-extra-p\"\nimport { parse as parseUrl } from \"url\"\nimport { Promise as BluebirdPromise } from \"bluebird\"\nimport * as path from \"path\"\n\nconst maxRedirects = 10\n\nexport const download = <(url: string, destination: string, isCreateDir?: boolean | undefined) => BluebirdPromise<any>>(BluebirdPromise.promisify(_download))\n\nfunction _download(url: string, destination: string, isCreateDir: boolean | undefined, callback: (error: Error) => void): void {\n  if (callback == null) {\n    callback = <any>isCreateDir\n    isCreateDir = true\n  }\n  doDownload(url, destination, 0, isCreateDir === undefined ? true : isCreateDir, callback)\n}\n\nexport function addTimeOutHandler(request: ClientRequest, callback: (error: Error) => void) {\n  request.on(\"socket\", function (socket: Socket) {\n    socket.setTimeout(60 * 1000, () => {\n      callback(new Error(\"Request timed out\"))\n      request.abort()\n    })\n  })\n}\n\nfunction doDownload(url: string, destination: string, redirectCount: number, isCreateDir: boolean, callback: (error: Error) => void) {\n  const ensureDirPromise = isCreateDir ? ensureDir(path.dirname(destination)) : BluebirdPromise.resolve()\n\n  const parsedUrl = parseUrl(url)\n  // user-agent must be specified, otherwise some host can return 401 unauthorised\n  const request = https.request({\n    hostname: parsedUrl.hostname,\n    path: parsedUrl.path,\n    headers: {\n      \"User-Agent\": \"electron-builder\"\n    }\n  }, (response: IncomingMessage) => {\n    if (response.statusCode >= 400) {\n      callback(new Error(\"Request error, status \" + response.statusCode + \": \" + response.statusMessage))\n      return\n    }\n\n    const redirectUrl = response.headers.location\n    if (redirectUrl != null) {\n      if (redirectCount < maxRedirects) {\n        doDownload(redirectUrl, destination, redirectCount++, isCreateDir, callback)\n      }\n      else {\n        callback(new Error(\"Too many redirects (> \" + maxRedirects + \")\"))\n      }\n      return\n    }\n\n    ensureDirPromise\n      .then(() => {\n        const downloadStream = createWriteStream(destination)\n        response.pipe(downloadStream)\n        downloadStream.on(\"finish\", () => downloadStream.close(callback))\n      })\n      .catch(callback)\n\n    let ended = false\n    response.on(\"end\", () => {\n      ended = true\n    })\n\n    response.on(\"close\", () => {\n      if (!ended) {\n        callback(new Error(\"Request aborted\"))\n      }\n    })\n  })\n  addTimeOutHandler(request, callback)\n  request.on(\"error\", callback)\n  request.end()\n}"
  ]
}
