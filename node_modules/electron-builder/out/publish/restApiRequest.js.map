{
  "version": 3,
  "file": "restApiRequest.js",
  "sourceRoot": "",
  "sources": [
    "../../src/publish/restApiRequest.ts"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "import * as https from \"https\"\nimport { RequestOptions } from \"https\"\nimport { IncomingMessage, ClientRequest } from \"http\"\nimport { addTimeOutHandler } from \"../util/httpRequest\"\nimport { Promise as BluebirdPromise } from \"bluebird\"\n\n//noinspection JSUnusedLocalSymbols\nconst __awaiter = require(\"../util/awaiter\")\n\nexport function githubRequest<T>(path: string, token: string | null, data: { [name: string]: any; } | null = null, method: string = \"GET\"): BluebirdPromise<T> {\n  return request<T>(\"api.github.com\", path, token, data, method)\n}\n\nexport function bintrayRequest<T>(path: string, auth: string | null, data: { [name: string]: any; } | null = null, method: string = \"GET\"): BluebirdPromise<T> {\n  return request<T>(\"api.bintray.com\", path, auth, data, method)\n}\n\nfunction request<T>(hostname: string, path: string, token: string | null, data: { [name: string]: any; } | null = null, method: string = \"GET\"): BluebirdPromise<T> {\n  const options: any = {\n    hostname: hostname,\n    path: path,\n    method: method,\n    headers: {\n      \"User-Agent\": \"electron-builder\"\n    }\n  }\n\n  if (hostname.includes(\"github\")) {\n    options.headers.Accept = \"application/vnd.github.v3+json\"\n  }\n\n  const encodedData = data == null ? null : new Buffer(JSON.stringify(data))\n  if (encodedData != null) {\n    options.method = \"post\"\n    options.headers[\"Content-Type\"] = \"application/json\"\n    options.headers[\"Content-Length\"] = encodedData.length\n  }\n  return doApiRequest<T>(options, token, it => it.end(encodedData))\n}\n\nexport function doApiRequest<T>(options: RequestOptions, token: string | null, requestProcessor: (request: ClientRequest, reject: (error: Error) => void) => void): BluebirdPromise<T> {\n  if (token != null) {\n    (<any>options.headers).authorization = token.startsWith(\"Basic\") ? token : `token ${token}`\n  }\n\n  return new BluebirdPromise<T>((resolve, reject, onCancel) => {\n    const request = https.request(options, (response: IncomingMessage) => {\n      try {\n        if (response.statusCode === 404) {\n          // error is clear, we don't need to read detailed error description\n          reject(new HttpError(response, `method: ${options.method} url: https://${options.hostname}${options.path}\n\nPlease double check that your GitHub Token is correct. Due to security reasons GitHub doesn't report actual status, but 404.\n`))\n        }\n        else if (response.statusCode === 204) {\n          // on DELETE request\n          resolve()\n          return\n        }\n\n        let data = \"\"\n        response.setEncoding(\"utf8\")\n        response.on(\"data\", (chunk: string) => {\n          data += chunk\n        })\n\n        response.on(\"end\", () => {\n          try {\n            if (response.statusCode >= 400) {\n              const contentType = response.headers[\"content-type\"]\n              if (contentType != null && contentType.includes(\"json\")) {\n                reject(new HttpError(response, JSON.parse(data)))\n              }\n              else {\n                reject(new HttpError(response))\n              }\n            }\n            else {\n              resolve(data.length === 0 ? null : JSON.parse(data))\n            }\n          }\n          catch (e) {\n            reject(e)\n          }\n        })\n      }\n      catch (e) {\n        reject(e)\n      }\n    })\n    addTimeOutHandler(request, reject)\n    request.on(\"error\", reject)\n    requestProcessor(request, reject)\n    onCancel!(() => request.abort())\n  })\n}\n\nexport class HttpError extends Error {\n  constructor(public response: IncomingMessage, public description: any = null) {\n    super(response.statusCode + \" \" + response.statusMessage + (description == null ? \"\" : (\"\\n\" + JSON.stringify(description, <any>null, \"  \"))) + \"\\nHeaders: \" + JSON.stringify(response.headers, <any>null, \"  \"))\n  }\n}"
  ]
}
