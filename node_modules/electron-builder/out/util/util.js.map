{
  "version": 3,
  "file": "util.js",
  "sourceRoot": "",
  "sources": [
    "../../src/util/util.ts"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "import { execFile, spawn as _spawn, ChildProcess, SpawnOptions } from \"child_process\"\nimport { Promise as BluebirdPromise } from \"bluebird\"\nimport { homedir } from \"os\"\nimport * as path from \"path\"\nimport { readJson, stat, Stats, unlink } from \"fs-extra-p\"\nimport { yellow, red } from \"chalk\"\nimport debugFactory = require(\"debug\")\nimport { warn, task, log } from \"./log\"\nimport { createHash } from \"crypto\"\n\n//noinspection JSUnusedLocalSymbols\nconst __awaiter = require(\"./awaiter\")\n\nexport const debug = debugFactory(\"electron-builder\")\nexport const debug7z = debugFactory(\"electron-builder:7z\")\n\nconst DEFAULT_APP_DIR_NAMES = [\"app\", \"www\"]\n\nexport function installDependencies(appDir: string, electronVersion: string, arch: string = process.arch, command: string = \"install\"): BluebirdPromise<any> {\n  return task(`${(command === \"install\" ? \"Installing\" : \"Rebuilding\")} app dependencies for arch ${arch} to ${appDir}`, spawnNpmProduction(command, appDir, getGypEnv(electronVersion, arch)))\n}\n\nexport function getGypEnv(electronVersion: string, arch: string): any {\n  const gypHome = path.join(homedir(), \".electron-gyp\")\n  return Object.assign({}, process.env, {\n    npm_config_disturl: \"https://atom.io/download/atom-shell\",\n    npm_config_target: electronVersion,\n    npm_config_runtime: \"electron\",\n    npm_config_arch: arch,\n    HOME: gypHome,\n    USERPROFILE: gypHome,\n  })\n}\n\nexport function spawnNpmProduction(command: string, appDir: string, env?: any): BluebirdPromise<any> {\n  let npmExecPath = process.env.npm_execpath || process.env.NPM_CLI_JS\n  const npmExecArgs = [command, \"--production\", \"--build-from-source\", \"--cache-min\", \"999999999\"]\n  if (npmExecPath == null) {\n    npmExecPath = process.platform === \"win32\" ? \"npm.cmd\" : \"npm\"\n  }\n  else {\n    npmExecArgs.unshift(npmExecPath)\n    npmExecPath = process.env.npm_node_execpath || process.env.NODE_EXE || \"node\"\n  }\n\n  return spawn(npmExecPath, npmExecArgs, {\n    cwd: appDir,\n    env: env || process.env\n  })\n}\n\nexport interface BaseExecOptions {\n  cwd?: string\n  env?: any\n  stdio?: any\n}\n\nexport interface ExecOptions extends BaseExecOptions {\n  customFds?: any\n  encoding?: string\n  timeout?: number\n  maxBuffer?: number\n  killSignal?: string\n}\n\nexport function removePassword(input: string): string {\n  return input.replace(/(-P |pass:|\\/p|-pass )([^ ]+)/, function (match, p1, p2) {\n    return `${p1}${createHash(\"sha256\").update(p2).digest(\"hex\")} (sha256 hash)`\n  })\n}\n\nexport function exec(file: string, args?: Array<string> | null, options?: ExecOptions): BluebirdPromise<string> {\n  if (debug.enabled) {\n    debug(`Executing ${file} ${args == null ? \"\" : removePassword(args.join(\" \"))}`)\n  }\n\n  return new BluebirdPromise<string>((resolve, reject) => {\n    execFile(file, <any>args, options, function (error, stdout, stderr) {\n      if (error == null) {\n        if (debug.enabled) {\n          if (stderr.length !== 0) {\n            log(stderr)\n          }\n        }\n        resolve(stdout)\n      }\n      else {\n        let message = red(removePassword(error.message))\n        if (stdout.length !== 0) {\n          message += `\\n${yellow(stdout)}`\n        }\n        if (stderr.length !== 0) {\n          message += `\\n${red(stderr)}`\n        }\n\n        reject(new Error(message))\n      }\n    })\n  })\n}\n\nexport function doSpawn(command: string, args: Array<string>, options?: SpawnOptions, pipeInput?: Boolean): ChildProcess {\n  if (options == null) {\n    options = {}\n  }\n  if (options.stdio == null) {\n    options.stdio = [pipeInput ? \"pipe\" : \"ignore\", debug.enabled ? \"inherit\" : \"pipe\", \"pipe\"]\n  }\n\n  if (debug.enabled) {\n    debug(`Spawning ${command} ${removePassword(args.join(\" \"))}`)\n  }\n  return _spawn(command, args, options)\n}\n\nexport function spawn(command: string, args?: Array<string> | null, options?: SpawnOptions): BluebirdPromise<any> {\n  return new BluebirdPromise<any>((resolve, reject) => {\n    handleProcess(\"close\", doSpawn(command, args || [], options), command, resolve, reject)\n  })\n}\n\nexport function handleProcess(event: string, childProcess: ChildProcess, command: string, resolve: ((value?: any) => void) | null, reject: (reason?: any) => void) {\n  childProcess.on(\"error\", reject)\n\n  let out = \"\"\n  if (!debug.enabled && childProcess.stdout != null) {\n    childProcess.stdout.on(\"data\", (data: string) => {\n      out += data\n    })\n  }\n\n  let errorOut = \"\"\n  if (childProcess.stderr != null) {\n    childProcess.stderr.on(\"data\", (data: string) => {\n      errorOut += data\n    })\n  }\n\n  childProcess.once(event, (code: number) => {\n    if (code === 0 && debug.enabled) {\n      debug(`${command} (${childProcess.pid}) exited with code ${code}`)\n    }\n\n    if (code !== 0) {\n      function formatOut(text: string, title: string) {\n        if (text.length === 0) {\n          return \"\"\n        }\n        else {\n          return `\\n${title}:\\n${text}`\n        }\n      }\n\n      reject(new Error(`${command} exited with code ${code}${formatOut(out, \"Output\")}${formatOut(errorOut, \"Error output\")}`))\n    }\n    else if (resolve != null) {\n      resolve()\n    }\n  })\n}\n\nexport async function getElectronVersion(packageData: any, packageJsonPath: string): Promise<string> {\n  const build = packageData.build\n  // build is required, but this check is performed later, so, we should check for null\n  if (build != null && build.electronVersion != null) {\n    return build.electronVersion\n  }\n\n  for (let name of [\"electron\", \"electron-prebuilt\", \"electron-prebuilt-compile\"]) {\n    try {\n      return (await readJson(path.join(path.dirname(packageJsonPath), \"node_modules\", name, \"package.json\"))).version\n    }\n    catch (e) {\n      if (e.code !== \"ENOENT\") {\n        warn(`Cannot read electron version from ${name} package.json: ${e.message}`)\n      }\n    }\n  }\n\n  const electronPrebuiltDep = findFromElectronPrebuilt(packageData)\n  if (electronPrebuiltDep == null) {\n    throw new Error(\"Cannot find electron dependency to get electron version in the '\" + packageJsonPath + \"'\")\n  }\n\n  const firstChar = electronPrebuiltDep[0]\n  return firstChar === \"^\" || firstChar === \"~\" ? electronPrebuiltDep.substring(1) : electronPrebuiltDep\n}\n\nfunction findFromElectronPrebuilt(packageData: any): any {\n  for (let name of [\"electron\", \"electron-prebuilt\", \"electron-prebuilt-compile\"]) {\n    const devDependencies = packageData.devDependencies\n    let dep = devDependencies == null ? null : devDependencies[name]\n    if (dep == null) {\n      const dependencies = packageData.dependencies\n      dep = dependencies == null ? null : dependencies[name]\n    }\n    if (dep != null) {\n      return dep\n    }\n  }\n  return null\n}\n\nexport async function statOrNull(file: string): Promise<Stats | null> {\n  try {\n    return await stat(file)\n  }\n  catch (e) {\n    if (e.code === \"ENOENT\") {\n      return null\n    }\n    else {\n      throw e\n    }\n  }\n}\n\nexport async function computeDefaultAppDirectory(projectDir: string, userAppDir: string | null | undefined): Promise<string> {\n  if (userAppDir != null) {\n    const absolutePath = path.resolve(projectDir, userAppDir)\n    const stat = await statOrNull(absolutePath)\n    if (stat == null) {\n      throw new Error(`Application directory ${userAppDir} doesn't exists`)\n    }\n    else if (!stat.isDirectory()) {\n      throw new Error(`Application directory ${userAppDir} is not a directory`)\n    }\n    else if (projectDir === absolutePath) {\n      warn(`Specified application directory \"${userAppDir}\" equals to project dir — superfluous or wrong configuration`)\n    }\n    return absolutePath\n  }\n\n  for (let dir of DEFAULT_APP_DIR_NAMES) {\n    const absolutePath = path.join(projectDir, dir)\n    const packageJson = path.join(absolutePath, \"package.json\")\n    const stat = await statOrNull(packageJson)\n    if (stat != null && stat.isFile()) {\n      return absolutePath\n    }\n  }\n  return projectDir\n}\n\nexport function use<T, R>(value: T | null, task: (it: T) => R): R | null {\n  return value == null ? null : task(value)\n}\n\nexport function debug7zArgs(command: \"a\" | \"x\"): Array<string> {\n  const args = [command, \"-bd\"]\n  if (debug7z.enabled) {\n    args.push(\"-bb3\")\n  }\n  else if (!debug.enabled) {\n    args.push(\"-bb0\")\n  }\n  return args\n}\n\nlet tmpDirCounter = 0\n// add date to avoid use stale temp dir\nconst tempDirPrefix = `${process.pid.toString(16)}-${Date.now().toString(16)}`\n\nexport function getTempName(prefix?: string | n): string {\n  return `${prefix == null ? \"\" : `${prefix}-`}${tempDirPrefix}-${(tmpDirCounter++).toString(16)}`\n}\n\nexport function isEmptyOrSpaces(s: string | n) {\n  return s == null || s.trim().length === 0\n}\n\nexport function unlinkIfExists(file: string) {\n  return unlink(file)\n    .catch(() => {\n      // ignore\n    })\n}\n\nexport function asArray<T>(v: n | T | Array<T>): Array<T> {\n  if (v == null) {\n    return []\n  }\n  else if (Array.isArray(v)) {\n    return v\n  }\n  else {\n    return [v]\n  }\n}\nexport function isCi(): boolean {\n  return (process.env.CI || \"\").toLowerCase() === \"true\"\n}"
  ]
}
